!function(){function e(){t(),a(),o(),R.on("GPS",s),R.on("AllLayers",l),R.on("AddLayer",l),R.on("RemoveLayers",c),$("#center-location").click(h),$("#marker-location").click(T),$("#remove-layers").click(i),$("#port-select").change(function(){var e=$("#port-select option:selected").text();""!=e&&R.emit("ChangePort",e)}),$("#follow-plane").click(u),$("#datepicker").change(d),C.on("mousemove",function(e){var t=numeral(e.latlng.lat).format("0.00000"),a=numeral(e.latlng.lng).format("0.00000");$("#cursor-location").text("Cursor: "+t+" "+a)}),C.on("draw:created",n),C.on("draw:deleted",r),C.on("zoomend",g),C.on("dragend",g)}function t(){L.tileLayer("maps/tiles/{z0}/{x0}/{x1}/{y0}/{y1}.png").addTo(C)}function a(){var e=new L.FeatureGroup;C.addLayer(e);var t=new L.Control.Draw({edit:{featureGroup:M}});C.addControl(t)}function o(){$("#datepicker").datepicker({changeMonth:!0,changeYear:!0})}function n(e){var t=e.layer.toGeoJSON(),a=e.layerType;t.properties.layerType=a,"circle"==a&&(t.properties.radius=e.layer._mRadius);try{console.log(e.layer),R.emit("LayerAdded",t)}catch(o){console.log(o)}}function r(e){console.log(e.target)}function l(e){if($.isArray(e))for(var t=0;t<e.length;t++)"circle"==e[t].data.properties.layerType?S.addLayer(k(e[t])):M.addData(e[t].data);else"circle"==e.data.properties.layerType?S.addLayer(k(e)):(console.log("single layer: "+e.data),M.addData(e.data))}function c(){G.clearLayers(),S.clearLayers(),M.clearLayers()}function i(){try{R.emit("RemoveLayers")}catch(e){console.log(e)}}function d(){$("#downloadgps").remove();var e=$("#datepicker").val();$("<a>",{"class":"btn btn-info btn-sm",id:"downloadgps",text:"Download",href:"/getgps?date="+e}).appendTo("#download-gps")}function s(e){if("VTG"==e.sentence||"RMC"==e.sentence)W.setAngle(e.trackTrue),J.speedKnots=e.speedKnots;else if("GGA"==e.sentence&&""!=e.lat&&""!=e.lon){var t=b(e.lat,e.lon);W.setLatLng(L.latLng(t.lat,t.lon)),J.latitude=t.lat,J.longitude=t.lon,J.altitude=e.alt,"fix"==e.fixType?($("#gps").removeClass("bad-gps"),$("#gps").addClass("good-gps"),p()):($("#gps").removeClass("good-gps"),$("#gps").addClass("bad-gps"),f());var a=numeral(J.latitude).format("0.00000"),o=numeral(J.longitude).format("0.00000"),n=numeral(3.280839895*J.altitude).format("0");$("#plane-location").text("Aircraft: "+a+" "+o),$("#plane-altitude").text("Altitude: "+n+" ft"),$("#plane-speed").text("Speed: "+J.speedKnots+" knots")}}function u(){D=!D,D?(m(),$("#fptext").css("color","#00ff00")):(y(),$("#fptext").removeAttr("style"))}function g(){if(v(),$("#show-bts").hasClass("active")){var e=C.getBounds(),t="/celltowers?lat1="+e.getNorthEast().lat+"&lon1="+e.getNorthEast().lng+"&lat2="+e.getNorthWest().lat+"&lon2="+e.getNorthWest().lng+"&lat3="+e.getSouthWest().lat+"&lon3="+e.getSouthWest().lng+"&lat4="+e.getSouthEast().lat+"&lon4="+e.getSouthEast().lng;$.get(t,function(e){console.log(e);var t=new Array(e.length);$("#bts-number").text("Num BTS: "+e.celltowers.length);for(var a=0;a<e.celltowers.length;a++){var o=e.celltowers[a],n="Radio: "+o.radio+"</br>Cell: "+o.cell+"</br>MCC: "+o.mcc+"</br>Net: "+o.net+"</br>Range(m): "+o.range;t[a]=L.marker([o.lat,o.lon]).bindPopup(n)}G=L.layerGroup(t).addTo(C)})}}function p(){0==z&&(x=setInterval(w,4e3),z=!0)}function f(){1==z&&(clearTimeout(x),z=!1)}function m(){A=setInterval(function(){C.panTo({lat:J.latitude,lon:J.longitude})},5e3)}function y(){clearTimeout(A)}function v(){$("#bts-number").text(""),C.removeLayer(G)}function h(){var e=$("#center-lat").val(),t=$("#center-lon").val();C.panTo({lat:e,lon:t})}function T(){var e=$("#marker-lat").val(),t=$("#marker-lon").val();console.log(e+" "+t);var a=new L.Marker(L.latLng({lat:e,lng:t}));a=a.toGeoJSON(),R.emit("LayerAdded",a)}function w(){var e=new L.Marker(L.latLng({lat:J.latitude,lng:J.longitude}),{icon:K});N.addLayer(e);setTimeout(function(){C.removeLayer(e)},6e5)}function b(e,t){var a=1*e.slice(0,2),o=e.slice(2,10)/60,n=a+o;a=1*t.slice(0,3),o=t.slice(3,11)/60;var r=a+o;return{lat:n,lon:r}}function k(e){if("circle"==e.data.properties.layerType){var t=e.data.geometry.coordinates[1],a=e.data.geometry.coordinates[0],o=e.data.properties.radius,n=L.circle([t,a],o);return n}}$(document).ready(e);var x,A,C=L.map("map",{center:[24.4,54.56],zoom:11}),G=L.layerGroup(),S=L.layerGroup().addTo(C),N=L.layerGroup().addTo(C),M=L.geoJson().addTo(C),R=io(),z=!1,D=!1,E=L.icon({iconUrl:"../images/plane.png",iconSize:[28,28],iconAnchor:[14,14],popupAnchor:[-14,-14]}),K=L.icon({iconUrl:"../images/breadcrumb.png",iconSize:[8,8],iconAnchor:[4,4]}),W=L.rotatedMarker([0,0],{icon:E}).addTo(C),J={latitude:0,longitude:0,heading:0,altiitude:0,speedKnots:0}}();